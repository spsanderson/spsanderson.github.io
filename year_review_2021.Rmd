---
title: "A Review of 2021"
author: "Steven P Sanderson II, MPH"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: show
    highlight: tango
    toc: no
    includes:
      in_header: GA_Script.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  warning = FALSE, 
  message = FALSE,
  fig.path = "man/figures/README-",
  fig.width = 12,
  fig.height = 10
  )
```

<img src="logos/healthyverse.png"  width="19.6%" align="center" />
<img src="logos/healthyr.png"      width="19.6%" align="center" />
<img src="logos/healthyr_data.png" width="19.6%" align="center" />
<img src="logos/healthyr_ts.png"   width="19.6%" align="center" />
<img src="logos/healthyr_ai.png"   width="19.6%" align="center" />

#
> __2021__ A Year in Review

The year 2021 was a big year for me. I did a lot of coding, a lot more than I 
typically do. The biggest push came personally in my ongoing development of my
R packages that are in the [healthyverse](www.spsanderson.com/healthyverse/). To
use the __healthyverse__ simply do so in the familiar fashion:

```{r install_healthyverse, echo=TRUE, eval=FALSE}
install.packages("healthyverse")
library(healthyverse)
```

In order to start looking at some of the data that pertains to 2021 lets first
get the data from the CRAN logs. Since I do this daily already, I can simply use
the rds file I already have. I am going to go through the motions though, in case
others might want to do something similar. The functions I am using to get the 
data can [be found here](https://github.com/spsanderson/healthyverse_tsa/blob/master/00_scripts/get_data_functions.R)

Now lets get that data!
```{r get_data}
library(tidyverse)
library(lubridate)
source("01_scripts/get_data_functions.R")
source("01_scripts/data_manipulation_functions.R")

get_cran_data()
get_package_release_data()
csv_to_rds()
```

Ok now that we have our data, lets ensure that we are only using the year 2021.
We can do this by filtering out data by time with the [timetk](https://business-science.github.io/timetk/) package. 

Now lets filter our data below, some pre-processing may need to take place.

```{r make_tibble}
library(timetk)
data_tbl <- downloads_processed_tbl() %>%
  filter_by_time(
    .date_var = date,
    .start_date = "2021",
    .end_date = "2021"
  )

glimpse(data_tbl)
```

Now that we have our data, we have it for the year 2021 only with a start date
of `r min(data_tbl$date)` and an end date of `r max(data_tbl$date)`.

# Package Information

The first thing we will do is look at how many downloads there were for each pacakge
and it's version.

```{r dl_by_pkg_v}
library(knitr)

data_tbl %>% 
  count(package, version) %>% 
  pivot_wider(
    id_cols       = version
    , names_from  = package
    , values_from = n
    , values_fill = 0
    ) %>%
  arrange(version) %>%
  kable()
```

Now lets see how many total downloads for the year there were for each package.

```{r total_dl}
data_tbl %>%
  count(package) %>%
  set_names("Package","Total Downloads") %>%
  kable()
```

Lets graph the data out as well.

```{r gaph_of_downloads}
data_tbl %>%
  count(package, version) %>%
  ggplot(aes(x = version, y = n, alpha = 0.382)) +
  geom_col(aes(group = package, fill = package)) +
  facet_wrap(package ~., ncol = 2, scales = "free") +
  scale_y_continuous(labels = scales::label_number(big.mark = ",")) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  labs(
    title = "Downloads by Package for 2021",
    subtitle = "Faceted by Package",
    x = "Version",
    y = "Downloads",
    fill = "Package"
  )

data_tbl %>%
  count(package, version) %>%
  group_by(package) %>%
  mutate(cumulative_downloads = cumsum(n)) %>%
  mutate(record = row_number()) %>%
  ungroup() %>%
  ggplot(aes(x = record, y = cumulative_downloads, alpha = 0.382)) +
  geom_col(aes(group = package, fill = package)) +
  facet_wrap(package ~., ncol = 2, scales = "free") +
  scale_y_continuous(labels = scales::label_number(big.mark = ",")) +
  theme_minimal() +
  theme(legend.position = "bottom") +
    labs(
    title = "Downloads by Package for 2021",
    subtitle = "Faceted by Package",
    x = "",
    y = "Downloads",
    fill = "Package"
  )

data_tbl %>%
  count(package, version) %>%
  group_by(package) %>%
  mutate(cumulative_downloads = cumsum(n)) %>%
  mutate(record = row_number()) %>%
  ungroup() %>%
  ggplot(aes(x = record, y = cumulative_downloads, alpha = 0.382)) +
  geom_line(aes(color = package, group = package), size = 1) +
  scale_y_continuous(labels = scales::label_number(big.mark = ",")) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  labs(
    title = "Cumulative Downloads by Package for 2021",
    subtitle = "Colored by Package",
    x = "",
    y = "Downloads",
    color = "Package"
  )
```

Now lets get some timeseries graphs.

```{r ts_plots}

```

# GitHub Stats

Now lets take a look at some quick stats from my [GitHub](https://www.github.com/spsanderson/)

First my contribution grid:

<img src="logos/github_contributions_2021.JPG" width="98.0%" align="center" />

Secondly my badge:

<img src="logos/github_badge.JPG" width="98.0%" align="center" />